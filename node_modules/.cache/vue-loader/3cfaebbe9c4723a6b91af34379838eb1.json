{"remainingRequest":"D:\\pc端clone\\iqiu\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\pc端clone\\iqiu\\src\\components\\liveroom\\LiveroomChat.vue?vue&type=style&index=0&id=095abdc7&scoped=true&lang=scss&","dependencies":[{"path":"D:\\pc端clone\\iqiu\\src\\components\\liveroom\\LiveroomChat.vue","mtime":1597738540961},{"path":"D:\\pc端clone\\iqiu\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\pc端clone\\iqiu\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\pc端clone\\iqiu\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\pc端clone\\iqiu\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\pc端clone\\iqiu\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\pc端clone\\iqiu\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIkAvYXNzZXRzL2Nzcy9faW5kZXguc2NzcyI7CgoubGl2ZS1jaGF0IHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CgogIC5jaGF0LXdyYXAgewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMjYwcHgpOwogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICRjb2xvci1ib3JkZXI7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgJGNvbG9yLWJvcmRlcjsKICB9CgogIC5naWZ0LWl0ZW0gewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgbGVmdDogMDsKICAgIHotaW5kZXg6IDE1OwogICAgd2lkdGg6IDEwMCU7CiAgICBsaW5lLWhlaWdodDogMTsKCiAgICAuZ2lmdC1pdGVtLXdyYXAgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGhlaWdodDogMTAwJTsKCiAgICAgIC5naWZ0LWF2YXRhciB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIGxlZnQ6IDA7CiAgICAgICAgdG9wOiAwOwogICAgICAgIG1hcmdpbi10b3A6IC01cHg7CiAgICAgICAgd2lkdGg6IDYwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI0ZGRURCRjsKICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgIH0KCiAgICAgIC5naWZ0LWNvbnRlbnQgewogICAgICAgIHdpZHRoOiAxNDRweDsKICAgICAgICBwYWRkaW5nLWxlZnQ6IDE3cHg7CiAgICAgIH0KCiAgICAgIC5naWZ0LXRpdGxlIHsKICAgICAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICBjb2xvcjogcmdiYSgyNTUsIDI0NCwgMTU3LCAxKTsKICAgICAgICB0ZXh0LXNoYWRvdzogMXB4IDFweCAxcHggcmdiYSg0NSwgNDUsIDQ1LCAwLjQ1KTsKICAgICAgICBAaW5jbHVkZSBlbGxpcHNpcygxKTsKICAgICAgfQoKICAgICAgLmdpZnQtbmFtZSB7CiAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgIGNvbG9yOiAjZmZmOwogICAgICB9CgogICAgICAuZ2lmdC1pY29uIHsKICAgICAgICBtYXJnaW4tdG9wOiAtMTJweDsKICAgICAgICBtYXJnaW4tcmlnaHQ6IDEycHg7CiAgICAgICAgd2lkdGg6IDQ4cHg7CiAgICAgICAgaGVpZ2h0OiA0OHB4OwogICAgICB9CgogICAgICAuZ2lmdC1jb3VudCB7CiAgICAgICAgbWFyZ2luLXRvcDogNnB4OwogICAgICAgIGZvbnQtc2l6ZTogMjRweDsKICAgICAgICBjb2xvcjogIzNCOTBGRjsKCiAgICAgICAgc3BhbiB7CiAgICAgICAgICBmb250LXNpemU6IDM4cHg7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0wIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA0OXB4OwogICAgICBiYWNrZ3JvdW5kOiB1cmwoJ35AL2Fzc2V0cy9pbWcvbGl2ZS1naWZ0LWJnMC5wbmcnKSAwIDAgbm8tcmVwZWF0OwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsKCiAgICAgIC5naWZ0LWNvdW50IHsKICAgICAgICBjb2xvcjogIzNCOTBGRjsKICAgICAgfQoKICAgICAgLmdpZnQtYXZhdGFyIHsKICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0xIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA0OXB4OwogICAgICBiYWNrZ3JvdW5kOiB1cmwoJ35AL2Fzc2V0cy9pbWcvbGl2ZS1naWZ0LWJnMS5wbmcnKSAwIDAgbm8tcmVwZWF0OwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsKCiAgICAgIC5naWZ0LWNvdW50IHsKICAgICAgICBjb2xvcjogI0VENUIxRTsKICAgICAgfQoKICAgICAgLmdpZnQtYXZhdGFyIHsKICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0yIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA1M3B4OwogICAgICBwYWRkaW5nLWxlZnQ6IDMwcHg7CiAgICAgIGJhY2tncm91bmQ6IHVybCgnfkAvYXNzZXRzL2ltZy9saXZlLWdpZnQtYmcyLnBuZycpIDAgMCBuby1yZXBlYXQ7CiAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICBiYWNrZ3JvdW5kLWNsaXA6IGNvbnRlbnQtYm94OwoKICAgICAgLmdpZnQtY291bnQgewogICAgICAgIGNvbG9yOiAjRkY2RDE1OwogICAgICB9CgogICAgICAuZ2lmdC1jb250ZW50IHsKICAgICAgICBwYWRkaW5nLWxlZnQ6IDM2cHg7CiAgICAgICAgd2lkdGg6IDkwcHg7CiAgICAgIH0KCiAgICAgIC5naWZ0LXRpdGxlIHsKICAgICAgICBtYXJnaW4tdG9wOiAxMnB4OwogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgfQoKICAgICAgLmdpZnQtaWNvbiB7CiAgICAgICAgbWFyZ2luLXRvcDogLTE1cHg7CiAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgICAgICAgd2lkdGg6IDYwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0zIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA1M3B4OwogICAgICBwYWRkaW5nLWxlZnQ6IDMwcHg7CiAgICAgIGJhY2tncm91bmQ6IHVybCgnfkAvYXNzZXRzL2ltZy9saXZlLWdpZnQtYmczLnBuZycpIDAgMCBuby1yZXBlYXQ7CiAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICBiYWNrZ3JvdW5kLWNsaXA6IGNvbnRlbnQtYm94OwoKICAgICAgLmdpZnQtY291bnQgewogICAgICAgIGNvbG9yOiAjNDk2N0YwOwogICAgICB9CgogICAgICAuZ2lmdC1jb250ZW50IHsKICAgICAgICBwYWRkaW5nLWxlZnQ6IDM2cHg7CiAgICAgICAgd2lkdGg6IDkwcHg7CiAgICAgIH0KCiAgICAgIC5naWZ0LXRpdGxlIHsKICAgICAgICBtYXJnaW4tdG9wOiAxMnB4OwogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgfQoKICAgICAgLmdpZnQtaWNvbiB7CiAgICAgICAgbWFyZ2luLXRvcDogLTE1cHg7CiAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgICAgICAgd2lkdGg6IDYwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICB9CiAgICB9CiAgfQoKICAuY2hhdCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBwYWRkaW5nOiAwIDE1cHg7CiAgICAvKmhlaWdodDogY2FsYygxMDB2aCAtIDQ5MHB4KTsqLwogICAgZm9udC1zaXplOiAxMnB4OwogICAgbGluZS1oZWlnaHQ6IDE4cHg7CiAgICBjb2xvcjogJGNvbG9yLXRpdGxlMjsKCiAgICBvdmVyZmxvdy14OiBoaWRkZW47CiAgICBvdmVyZmxvdy15OiBzY3JvbGw7CgogICAgLm1haW4gewogICAgICBjb2xvcjogJGNvbG9yLW1haW47CiAgICB9CgogICAgLmJhbiB7CiAgICAgIGNvbG9yOiAkY29sb3ItYmFuOwogICAgfQoKICAgIC5ob25nYmFvIHsKICAgICAgY29sb3I6ICRjb2xvci1yZWQtZW52ZWxvcGU7CiAgICB9CgogICAgLmdpZnQgewogICAgICBjb2xvcjogJGNvbG9yLWdpZnQ7CiAgICB9CgoKICAgIC5jaGF0LWl0ZW0gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBwYWRkaW5nOiA3cHggMDsKICAgIH0KCiAgICAuaXRlbS1uYW1lIHsKICAgICAgZmxleDogMTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBAZXh0ZW5kIC5tYWluOwogICAgfQoKICAgIC5pdGVtLWNvbnRlbnQgewogICAgICBtYXJnaW4tbGVmdDogMTBweDsKICAgICAgY3Vyc29yOiBkZWZhdWx0OwogICAgICBjb2xvcjogJGNvbG9yLXRpdGxlMjsKICAgIH0KCiAgICAuZ2lmdC1pY29uIHsKICAgICAgd2lkdGg6IDMycHg7CiAgICAgIGhlaWdodDogMzJweDsKICAgIH0KCiAgICAucm9sZS1pY29uIHsKICAgICAgbWFyZ2luLXJpZ2h0OiA0cHg7CiAgICAgIHdpZHRoOiAyNnB4OwogICAgICBoZWlnaHQ6IDE0cHg7CiAgICB9CiAgfQoKICAubmV3LW1lc3NhZ2UtYnRuIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJvdHRvbTogMDsKICAgIHJpZ2h0OiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDM0cHg7CiAgICBsaW5lLWhlaWdodDogMzRweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGJhY2tncm91bmQ6IHJnYmEoMjQ2LCAyNDksIDI1NSwgMSk7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgfQp9Cgo="},{"version":3,"sources":["LiveroomChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8dA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LiveroomChat.vue","sourceRoot":"src/components/liveroom","sourcesContent":["<template>\r\n  <div class=\"live-chat\">\r\n    <!--横幅礼物-->\r\n    <transition-group name=\"gift\" appear tap=\"div\" class=\"gift-item\">\r\n      <div v-for=\"(item) in showingList\" :key=\"item.vueKey\">\r\n        <div v-if=\"item.active\" class=\"gift-item-wrap\" :class=\"classObject(item)\">\r\n          <img class=\"gift-avatar\" :src=\"item.user.avatar\" alt=\"\">\r\n          <div class=\"gift-content\">\r\n            <div class=\"gift-title\">{{ item.user.name }}</div>\r\n            <div class=\"gift-name\">送出 {{ item.gift.name }}</div>\r\n          </div>\r\n          <img class=\"gift-icon\" :src=\"item.gift.picture\" alt=\"\">\r\n          <div class=\"gift-count font-gift\">x <span>{{ item.gift.number }}</span></div>\r\n        </div>\r\n      </div>\r\n    </transition-group>\r\n\r\n    <!--聊天室-->\r\n    <section class=\"chat-wrap\">\r\n      <!--聊天内容-->\r\n      <section ref=\"chat\" class=\"chat\" id=\"chat\" @scroll=\"chatScroll\" @click.stop=\"handleBan\">\r\n        <div class=\"chat-item\" v-for=\"(item,index) in msgList\" :key=\"item.sign\">\r\n          <!--消息三种类型 1 发言 name: content 2 礼物 name num pic 3 系统通知 颜色不同-->\r\n          <!--文本消息-->\r\n          <template v-if=\"item._lctype === -1\">\r\n            <img class=\"role-icon\" v-if=\"item._lcattrs.user.role != 0\"\r\n                 :src=\"require('@/assets/img/live-chat-role'+item._lcattrs.user.role+'.png')\" alt=\"\">\r\n            <div>\r\n              <span class=\"item-name\" :data-item=\"index\">{{ item._lcattrs.user.name }}:            </span>\r\n              <span\r\n                class=\"item-content\">{{ item._lctext }}</span></div>\r\n          </template>\r\n          <!--系统消息&禁言-->\r\n          <template v-else-if=\"item._lctype === 1 || item._lctype === 5\">\r\n            <span class=\"main\"\r\n                  :class=\"{'ban':item._lctype === 5, 'hongbao': item._lctype === 1 && (item._lcattrs && item._lcattrs.sm.type === 0)}\">{{ item._lctext }}</span>\r\n          </template>\r\n          <!--礼物  老张涨涨送给主播甜甜圈 66-->\r\n          <template v-else-if=\"item._lctype === 2\">\r\n            <span class=\"gift\">{{ item._lcattrs.user.name }}送给主播{{ item._lcattrs.gift.name }}</span>\r\n            <img class=\"gift-icon\" :src=\"item._lcattrs.gift.picture\" alt=\"\">\r\n            <span class=\"gift\">{{ item._lcattrs.gift.number }}</span>\r\n          </template>\r\n          <!--<span v-if=\"item._lctype === 1\" class=\"item-name\" :data-item=\"item.content\">{{ item._lctext }}</span>-->\r\n        </div>\r\n      </section>\r\n      <!--新消息-->\r\n      <div class=\"new-message-btn\" v-show=\"newMessage > 0\" @click.stop=\"handleScrollToEnd\"> {{newMessage}}个新消息</div>\r\n      <!--禁言弹窗-->\r\n      <LiveroomBan ref=\"ban\" :userInfo=\"userInfo\"></LiveroomBan>\r\n      <!--红包-->\r\n<!--      <LiveroomHongbao :userLogin=\"userLogin\" v-for=\"(item,index) in hongbaoList\" :key=\"index\"-->\r\n<!--                       :hongbaoItem=\"item\" @login=\"$emit('login')\"  @receiveHongBaoSuccess=\"$emit('hongBaoSuccess')\"></LiveroomHongbao>-->\r\n      <!--礼物gif-->\r\n      <LiveroomGif :giftItem=\"giftItem\" :giftListToObject=\"giftListToObject\"></LiveroomGif>\r\n    </section>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import LiveroomBan from '@/components/liveroom/LiveroomBan'\r\n  // import LiveroomHongbao from '@/components/liveroom/LiveroomHongbao'\r\n  import LiveroomGif from '@/components/liveroom/LiveroomGif'\r\n\r\n  import { debounce } from \"@/utils/debounceAndthrottle\";\r\n\r\n  /*\r\n  * 层级\r\n  * 禁言菜单30>礼物特效25>红包20>礼物横幅15>榜单5>消息\r\n  *\r\n  * 礼物横幅 设计思路\r\n  * showingList 展示中的列表 最大长度3 加入时添加setTimeout，如果展示时间内用户名称和礼物名称相同，则改变礼物数量并重新计算展示时间，时间到了查找showingList里（用户名称和礼物名称）的对应项并删除\r\n  * taskList 任务列表 添加礼物信息push到最后，更新showingList时shift取出\r\n  * updateShowingList  （条件是 展示区<3条、缓存区>0）区分入参 兼容同一人统一礼物已展示情况\r\n  *\r\n  * 礼物横幅样式规则\r\n  * 0~0.99元\r\n  * 1~99元\r\n  * 100元~499元\r\n  * 500元以上\r\n  *\r\n  * 优化点\r\n  * 消失前 同一用户同一礼物 更新数量及重新计算展示时间 最多展示3个 遍历对比取值判断可以接受\r\n  */\r\n  export default {\r\n    name: 'LiveroomChat',\r\n    components: {\r\n      LiveroomBan,\r\n      // LiveroomHongbao,\r\n      LiveroomGif\r\n    },\r\n    props: {\r\n      giftItem: Object,\r\n      userLogin: {\r\n        type: Object,\r\n        default: () => {\r\n          return {}\r\n        }\r\n      },\r\n      userInfo: {\r\n        type: Object,\r\n        default: () => {\r\n          return {}\r\n        }\r\n      },\r\n      msgList: {\r\n        type: Array,\r\n        default: () => {\r\n          return []\r\n        }\r\n      },\r\n      hongbaoList: {\r\n        type: Array,\r\n        default: () => {\r\n          return []\r\n        }\r\n      },\r\n      giftListToObject: {\r\n        type: Object,\r\n        default: () => {\r\n          return {}\r\n        }\r\n      }\r\n    },\r\n    // computed: {\r\n    //   classObject: function (item) {\r\n    //     console.log(item);\r\n    //     return {\r\n    //       active: true,\r\n    //       'text-danger': true\r\n    //     }\r\n    //   }\r\n    // },\r\n    watch: {\r\n      // 弹幕中获取新的礼物\r\n      giftItem: {\r\n        handler: function (newValue) {\r\n          // console.log(oldValue, 'oldValue');\r\n          // console.log(newValue, 'newValue');\r\n          if (!newValue) return;\r\n          // 添加标识\r\n          newValue.showId = newValue.gift.anchorName + '_' + newValue.gift.id\r\n          newValue.active = false\r\n          newValue.vueKey = new Date().getTime()\r\n          let item = JSON.parse(JSON.stringify(newValue));\r\n          this.taskList.push(item)\r\n          this.$nextTick(() => {\r\n            this.updateShowingList(item)\r\n          })\r\n        },\r\n        immediate: false\r\n      },\r\n      // 弹幕信息\r\n      msgList: {\r\n        handler: function () {\r\n          // console.log(oldValue, 'oldValue');\r\n          // console.log(newValue, 'newValue');\r\n          if (this.$refs.chat) {\r\n            let scrollTarget = this.$refs.chat;\r\n            // 到底或者 滚动高度大于视图高度\r\n            let isScrollToEnd = (scrollTarget.scrollHeight - scrollTarget.scrollTop === scrollTarget.clientHeight) || (scrollTarget.scrollHeight <= scrollTarget.clientHeight + 15);// hack scrollHeight默认大于clientHeight问题\r\n\r\n            console.log(scrollTarget.scrollTop, 'scrollTarget.scrollTop');\r\n            console.log(scrollTarget.scrollHeight, 'scrollTarget.scrollHeight');\r\n            console.log(scrollTarget.clientHeight, 'scrollTarget.clientHeight');\r\n            console.log(isScrollToEnd, 'isScrollToEnd');\r\n\r\n            this.$nextTick(() => {\r\n              // 添加消息 有scrollTop 或者 内容>视口\r\n              let isAddMessage = scrollTarget.scrollTop > 0 || scrollTarget.scrollHeight >= scrollTarget.clientHeight + 15\r\n              console.log(isAddMessage);\r\n              if (isScrollToEnd) {\r\n                this.newMessage = 0;\r\n                scrollTarget.scrollTop = scrollTarget.scrollHeight\r\n              } else if (isAddMessage) {\r\n                // 未显示的消息增加\r\n                this.newMessage++\r\n              }\r\n            })\r\n          }\r\n        },\r\n        immediate: false\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        // hongbaoList: [],\r\n        banDialog: false,\r\n        // scrollTarget: null,\r\n        newMessage: 0, // 未显示的消息\r\n\r\n        showingList: [\r\n          // {\r\n          //   showId: '冯曦妤_12915206930636800',\r\n          //   active: true,\r\n          //   vueKey: 1,\r\n          //   \"gift\": {\r\n          //     \"anchorId\": \"6919164\",\r\n          //     \"anchorName\": \"冯曦妤\",\r\n          //     \"id\": 12915206930636802,\r\n          //     \"name\": \"浪味仙\",\r\n          //     \"number\": 1,\r\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\r\n          //     \"showGift\": true,\r\n          //     \"totalFee\": 10\r\n          //   },\r\n          //   \"pType\": 0,\r\n          //   \"pid\": \"6919164\",\r\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\r\n          //   \"user\": {\r\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\r\n          //     \"id\": \"3486074\",\r\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\r\n          //   }\r\n          // }, {\r\n          //   showId: '冯曦妤_12915206930636801',\r\n          //   active: true,\r\n          //   vueKey: 2,\r\n          //   \"gift\": {\r\n          //     \"anchorId\": \"6919164\",\r\n          //     \"anchorName\": \"冯曦妤\",\r\n          //     \"id\": 12915206930636802,\r\n          //     \"name\": \"浪味仙\",\r\n          //     \"number\": 1,\r\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\r\n          //     \"showGift\": true,\r\n          //     \"totalFee\": 10000\r\n          //   },\r\n          //   \"pType\": 0,\r\n          //   \"pid\": \"6919164\",\r\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\r\n          //   \"user\": {\r\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\r\n          //     \"id\": \"3486074\",\r\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\r\n          //   }\r\n          // }, {\r\n          //   showId: '冯曦妤_12915206930636802',\r\n          //   active: true,\r\n          //   vueKey: 3,\r\n          //   \"gift\": {\r\n          //     \"anchorId\": \"6919164\",\r\n          //     \"anchorName\": \"冯曦妤\",\r\n          //     \"id\": 12915206930636802,\r\n          //     \"name\": \"浪味仙\",\r\n          //     \"number\": 1,\r\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\r\n          //     \"showGift\": true,\r\n          //     \"totalFee\": 10000000\r\n          //   },\r\n          //   \"pType\": 0,\r\n          //   \"pid\": \"6919164\",\r\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\r\n          //   \"user\": {\r\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\r\n          //     \"id\": \"3486074\",\r\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\r\n          //   }\r\n          // }, {\r\n          //   showId: '冯曦妤_12915206930636803',\r\n          //   active: true,\r\n          //   vueKey: 4,\r\n          //   \"gift\": {\r\n          //     \"anchorId\": \"6919164\",\r\n          //     \"anchorName\": \"冯曦妤\",\r\n          //     \"id\": 12915206930636802,\r\n          //     \"name\": \"浪味仙\",\r\n          //     \"number\": 1,\r\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\r\n          //     \"showGift\": true,\r\n          //     \"totalFee\": 1000\r\n          //   },\r\n          //   \"pType\": 0,\r\n          //   \"pid\": \"6919164\",\r\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\r\n          //   \"user\": {\r\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\r\n          //     \"id\": \"3486074\",\r\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\r\n          //   }\r\n          // },\r\n          // {\r\n          //   showId: '冯曦妤_12915206930636802',\r\n          //   active:true,\r\n          //   vueKey:2,\r\n          //   \"gift\": {\r\n          //     \"anchorId\": \"6919164\",\r\n          //     \"anchorName\": \"冯曦妤\",\r\n          //     \"id\": 12915206930636802,\r\n          //     \"name\": \"浪味仙\",\r\n          //     \"number\": 1,\r\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\r\n          //     \"showGift\": true,\r\n          //     \"totalFee\": 10\r\n          //   },\r\n          //   \"pType\": 0,\r\n          //   \"pid\": \"6919164\",\r\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\r\n          //   \"user\": {\r\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\r\n          //     \"id\": \"3486074\",\r\n          //     \"name\": \"晨曦吻月\"\r\n          //   }\r\n          // }\r\n        ], // 展示中的礼物横条\r\n        taskList: [] // 待展示的礼物横条\r\n      }\r\n    },\r\n    created() {\r\n      // test 红包\r\n      // this.hongbaoList.push({\r\n      //\r\n      // })\r\n      // this.hongbaoList.push({\r\n      //\r\n      // })\r\n      // this.updateShowingList()\r\n      // console.log(this.giftItem, 'giftItem');\r\n    },\r\n    mounted() {\r\n      // this.scrollTarget = document.getElementById(\"chat\")\r\n    },\r\n    methods: {\r\n      /**\r\n       * 0~0.99元\r\n       * 1~99元\r\n       * 100元~499元\r\n       * 500元以上\r\n       * */\r\n      classObject(item) {\r\n        console.log(item.gift.totalFee);\r\n        return {\r\n          'gift-item-0': item.gift.totalFee >= 0 && item.gift.totalFee <= 99,\r\n          'gift-item-1': item.gift.totalFee >= 99 && item.gift.totalFee <= 9900,\r\n          'gift-item-2': item.gift.totalFee >= 10000 && item.gift.totalFee <= 49900,\r\n          'gift-item-3': item.gift.totalFee >= 50000,\r\n        }\r\n      },\r\n      // 点击用户姓名 判断条件权限 是否线上禁用弹窗\r\n      handleBan(e) {\r\n        console.log(e);\r\n        // if (e.target.className.toLowerCase() == \"item-name\" && e.target.dataset.item) {\r\n          this.$refs.ban.show(this.msgList[e.target.dataset.item])\r\n          console.log(this.msgList[e.target.dataset.item]);\r\n          console.log(e.target.dataset.item);\r\n        // }\r\n      },\r\n      // 节流处理 滚动到底 push信息也会触发\r\n      chatScroll: debounce(function (e) {\r\n        if (e && e.target.scrollHeight - e.target.scrollTop == e.target.clientHeight) {\r\n          this.newMessage = 0;\r\n          e.target.scrollTop = e.target.scrollHeight\r\n        }\r\n        console.log(e);\r\n      }, 500, false),\r\n      // chatScroll(e) {\r\n      //   if (e.target.scrollHeight - e.target.scrollTop == e.target.clientHeight) {\r\n      //     this.newMessage = 0;\r\n      //     e.target.scrollTop = e.target.scrollHeight\r\n      //   }\r\n      //   console.log(e);\r\n      // },\r\n      // 手动点击回到底部\r\n      handleScrollToEnd() {\r\n        let scrollTarget = this.$refs.chat;\r\n        scrollTarget.scrollTop = scrollTarget.scrollHeight;\r\n        this.newMessage = 0;\r\n      },\r\n      /**\r\n       * 横幅显示时间\r\n       * 大于100块，2分钟\r\n       * 大于50块数目小于10块，1.5分钟\r\n       * 大于10块小于50块并且礼物数小于10，显示1分钟\r\n       * 其他情况是，3秒+礼物的总价格*3毫秒\r\n       * 异常 3s\r\n       */\r\n      showingTime(totalFee) {\r\n        if (isNaN(totalFee)) totalFee = 0;\r\n        if (totalFee > 100 * 100) {\r\n          return 1000 * 60 * 2;\r\n        } else if (totalFee > 50 * 100) {\r\n          return 1000 * 60 * 1.5;\r\n        } else if (totalFee > 10 * 100) {\r\n          return 1000 * 60 * 1;\r\n        } else {\r\n          return 1000 * 3 + totalFee * 3;\r\n        }\r\n      },\r\n      /**\r\n       * 移除过期横幅及更新定时器\r\n       * @param type update/clear\r\n       * @param item 展示项\r\n       * @param callBack\r\n       * @returns {number}\r\n       */\r\n      updateSetTimeout(type, item, callBack) {\r\n        let timer = null;\r\n        timer = setTimeout(() => {\r\n          console.log(item.showId, 'showId');\r\n          console.log(this.showingTime(item.gift.totalFee), '显示时间');\r\n\r\n          // 离开动画\r\n          item.active = type == 'update' ? true : false;\r\n          // 通过showId更新位置\r\n          let showId = item.showId\r\n          let index = this.showingList.findIndex(item => (item.showId == showId))\r\n          if (index !== undefined) this.showingList.splice(index, 1)\r\n\r\n          if (callBack) callBack()\r\n        }, this.showingTime(item.gift.totalFee))\r\n\r\n        // 清除绑定的定时器\r\n        this.$once('hook:beforeDestroy', () => {\r\n          console.log(\"hook:beforeDestroy\");\r\n          clearTimeout(timer);\r\n        })\r\n        return timer;\r\n      },\r\n      // 更新横幅\r\n      updateShowingList(newMessage) {\r\n        console.log('updateShowingList----start');\r\n\r\n        let isUpdate = false; // 更新现有横幅/需要继续插入显示列表\r\n        // 优先判断是否是 同一用户用一种礼物\r\n        if (newMessage && this.showingList.length > 0 && this.showingList.length < 3) {\r\n          console.log(newMessage, 'newMessage');\r\n          // 显示两个同名字同礼物的横幅  更新显示的时间是第一个时间\r\n          this.showingList.forEach((item) => {\r\n            if (isUpdate) return;\r\n            if (item.showId == newMessage.showId) {\r\n              console.log('重复遍历');\r\n              // 有在显示的横幅 移除队列最新推入项\r\n              this.taskList.pop()\r\n              // 更新显示的横幅\r\n              item.gift.number = item.gift.number + newMessage.gift.number\r\n              // 更新定时器\r\n              clearTimeout(item.timer);\r\n              item.timer = this.updateSetTimeout('update', item);\r\n              isUpdate = true;\r\n            }\r\n          })\r\n        }\r\n\r\n        console.log(isUpdate, 'isUpdate');\r\n        if (!isUpdate && this.showingList.length < 3 && this.taskList.length > 0) {\r\n          const item = this.taskList.shift()\r\n          // 进场动画\r\n          item.active = true;\r\n          // 定时移除显示\r\n          item.timer = this.updateSetTimeout('clear', item, this.updateShowingList)\r\n\r\n          // item.timer = setTimeout(() => {\r\n          //   let showId = item.showId;\r\n          //\r\n          //     // 离开动画\r\n          //   item.active = true;\r\n          //   console.log(item.gift.anchorName,'item.gift.anchorName');\r\n          //\r\n          //   let index = this.showingList.findIndex((item,index) => {\r\n          //     console.log(this.showingList[index].gift.anchorName);\r\n          //     return (item.showId == showId)\r\n          //   })\r\n          //   if(index !== undefined) this.showingList.splice(index,1)\r\n          //   // 更新队列\r\n          //   this.updateShowingList()\r\n          //\r\n          // }, this.showingTime(item.gift.totalFee))\r\n\r\n          this.showingList.push(item);\r\n        }\r\n\r\n        console.log('updateShowingList----end');\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  @import \"@/assets/css/_index.scss\";\r\n\r\n  .live-chat {\r\n    position: relative;\r\n\r\n    .chat-wrap {\r\n      position: relative;\r\n      height: calc(100vh - 260px);\r\n      border-top: 1px solid $color-border;\r\n      border-bottom: 1px solid $color-border;\r\n    }\r\n\r\n    .gift-item {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      z-index: 15;\r\n      width: 100%;\r\n      line-height: 1;\r\n\r\n      .gift-item-wrap {\r\n        position: relative;\r\n        display: flex;\r\n        height: 100%;\r\n\r\n        .gift-avatar {\r\n          position: absolute;\r\n          left: 0;\r\n          top: 0;\r\n          margin-top: -5px;\r\n          width: 60px;\r\n          height: 60px;\r\n          box-sizing: border-box;\r\n          border: 3px solid #FFEDBF;\r\n          border-radius: 50%;\r\n        }\r\n\r\n        .gift-content {\r\n          width: 144px;\r\n          padding-left: 17px;\r\n        }\r\n\r\n        .gift-title {\r\n          margin-top: 10px;\r\n          margin-bottom: 4px;\r\n          font-size: 13px;\r\n          font-weight: 500;\r\n          color: rgba(255, 244, 157, 1);\r\n          text-shadow: 1px 1px 1px rgba(45, 45, 45, 0.45);\r\n          @include ellipsis(1);\r\n        }\r\n\r\n        .gift-name {\r\n          font-size: 12px;\r\n          color: #fff;\r\n        }\r\n\r\n        .gift-icon {\r\n          margin-top: -12px;\r\n          margin-right: 12px;\r\n          width: 48px;\r\n          height: 48px;\r\n        }\r\n\r\n        .gift-count {\r\n          margin-top: 6px;\r\n          font-size: 24px;\r\n          color: #3B90FF;\r\n\r\n          span {\r\n            font-size: 38px;\r\n          }\r\n        }\r\n      }\r\n\r\n      .gift-item-0 {\r\n        margin-top: 32px;\r\n        height: 49px;\r\n        background: url('~@/assets/img/live-gift-bg0.png') 0 0 no-repeat;\r\n        background-size: 100% 100%;\r\n\r\n        .gift-count {\r\n          color: #3B90FF;\r\n        }\r\n\r\n        .gift-avatar {\r\n          display: none;\r\n        }\r\n      }\r\n\r\n      .gift-item-1 {\r\n        margin-top: 32px;\r\n        height: 49px;\r\n        background: url('~@/assets/img/live-gift-bg1.png') 0 0 no-repeat;\r\n        background-size: 100% 100%;\r\n\r\n        .gift-count {\r\n          color: #ED5B1E;\r\n        }\r\n\r\n        .gift-avatar {\r\n          display: none;\r\n        }\r\n      }\r\n\r\n      .gift-item-2 {\r\n        margin-top: 32px;\r\n        height: 53px;\r\n        padding-left: 30px;\r\n        background: url('~@/assets/img/live-gift-bg2.png') 0 0 no-repeat;\r\n        background-size: 100% 100%;\r\n        background-clip: content-box;\r\n\r\n        .gift-count {\r\n          color: #FF6D15;\r\n        }\r\n\r\n        .gift-content {\r\n          padding-left: 36px;\r\n          width: 90px;\r\n        }\r\n\r\n        .gift-title {\r\n          margin-top: 12px;\r\n          font-size: 14px;\r\n        }\r\n\r\n        .gift-icon {\r\n          margin-top: -15px;\r\n          margin-right: 8px;\r\n          width: 60px;\r\n          height: 60px;\r\n        }\r\n      }\r\n\r\n      .gift-item-3 {\r\n        margin-top: 32px;\r\n        height: 53px;\r\n        padding-left: 30px;\r\n        background: url('~@/assets/img/live-gift-bg3.png') 0 0 no-repeat;\r\n        background-size: 100% 100%;\r\n        background-clip: content-box;\r\n\r\n        .gift-count {\r\n          color: #4967F0;\r\n        }\r\n\r\n        .gift-content {\r\n          padding-left: 36px;\r\n          width: 90px;\r\n        }\r\n\r\n        .gift-title {\r\n          margin-top: 12px;\r\n          font-size: 14px;\r\n        }\r\n\r\n        .gift-icon {\r\n          margin-top: -15px;\r\n          margin-right: 8px;\r\n          width: 60px;\r\n          height: 60px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .chat {\r\n      height: 100%;\r\n      padding: 0 15px;\r\n      /*height: calc(100vh - 490px);*/\r\n      font-size: 12px;\r\n      line-height: 18px;\r\n      color: $color-title2;\r\n\r\n      overflow-x: hidden;\r\n      overflow-y: scroll;\r\n\r\n      .main {\r\n        color: $color-main;\r\n      }\r\n\r\n      .ban {\r\n        color: $color-ban;\r\n      }\r\n\r\n      .hongbao {\r\n        color: $color-red-envelope;\r\n      }\r\n\r\n      .gift {\r\n        color: $color-gift;\r\n      }\r\n\r\n\r\n      .chat-item {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 7px 0;\r\n      }\r\n\r\n      .item-name {\r\n        flex: 1;\r\n        cursor: pointer;\r\n        @extend .main;\r\n      }\r\n\r\n      .item-content {\r\n        margin-left: 10px;\r\n        cursor: default;\r\n        color: $color-title2;\r\n      }\r\n\r\n      .gift-icon {\r\n        width: 32px;\r\n        height: 32px;\r\n      }\r\n\r\n      .role-icon {\r\n        margin-right: 4px;\r\n        width: 26px;\r\n        height: 14px;\r\n      }\r\n    }\r\n\r\n    .new-message-btn {\r\n      position: absolute;\r\n      bottom: 0;\r\n      right: 0;\r\n      width: 100%;\r\n      height: 34px;\r\n      line-height: 34px;\r\n      text-align: center;\r\n      background: rgba(246, 249, 255, 1);\r\n      cursor: pointer;\r\n    }\r\n  }\r\n\r\n</style>\r\n"]}]}