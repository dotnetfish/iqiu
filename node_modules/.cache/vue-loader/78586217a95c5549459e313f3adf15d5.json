{"remainingRequest":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/src/components/liveroom/LiveroomChat.vue?vue&type=style&index=0&id=095abdc7&scoped=true&lang=scss&","dependencies":[{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/src/components/liveroom/LiveroomChat.vue","mtime":1595570908569},{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/css-loader/dist/cjs.js","mtime":1595570903613},{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1595570907990},{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/postcss-loader/src/index.js","mtime":1595570906300},{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/sass-loader/dist/cjs.js","mtime":1595570907455},{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/cache-loader/dist/cjs.js","mtime":1595570902420},{"path":"/Users/zj-db0720/work/sourcescode/projects/gitee/iqiu/node_modules/vue-loader/lib/index.js","mtime":1595570907990}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIkAvYXNzZXRzL2Nzcy9faW5kZXguc2NzcyI7CgoubGl2ZS1jaGF0IHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CgogIC5jaGF0LXdyYXAgewogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMjYwcHgpOwogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICRjb2xvci1ib3JkZXI7CiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgJGNvbG9yLWJvcmRlcjsKICB9CgogIC5naWZ0LWl0ZW0gewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgdG9wOiAwOwogICAgbGVmdDogMDsKICAgIHotaW5kZXg6IDE1OwogICAgd2lkdGg6IDEwMCU7CiAgICBsaW5lLWhlaWdodDogMTsKCiAgICAuZ2lmdC1pdGVtLXdyYXAgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGhlaWdodDogMTAwJTsKCiAgICAgIC5naWZ0LWF2YXRhciB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIGxlZnQ6IDA7CiAgICAgICAgdG9wOiAwOwogICAgICAgIG1hcmdpbi10b3A6IC01cHg7CiAgICAgICAgd2lkdGg6IDYwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI0ZGRURCRjsKICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgIH0KCiAgICAgIC5naWZ0LWNvbnRlbnQgewogICAgICAgIHdpZHRoOiAxNDRweDsKICAgICAgICBwYWRkaW5nLWxlZnQ6IDE3cHg7CiAgICAgIH0KCiAgICAgIC5naWZ0LXRpdGxlIHsKICAgICAgICBtYXJnaW4tdG9wOiAxMHB4OwogICAgICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICBjb2xvcjogcmdiYSgyNTUsIDI0NCwgMTU3LCAxKTsKICAgICAgICB0ZXh0LXNoYWRvdzogMXB4IDFweCAxcHggcmdiYSg0NSwgNDUsIDQ1LCAwLjQ1KTsKICAgICAgICBAaW5jbHVkZSBlbGxpcHNpcygxKTsKICAgICAgfQoKICAgICAgLmdpZnQtbmFtZSB7CiAgICAgICAgZm9udC1zaXplOiAxMnB4OwogICAgICAgIGNvbG9yOiAjZmZmOwogICAgICB9CgogICAgICAuZ2lmdC1pY29uIHsKICAgICAgICBtYXJnaW4tdG9wOiAtMTJweDsKICAgICAgICBtYXJnaW4tcmlnaHQ6IDEycHg7CiAgICAgICAgd2lkdGg6IDQ4cHg7CiAgICAgICAgaGVpZ2h0OiA0OHB4OwogICAgICB9CgogICAgICAuZ2lmdC1jb3VudCB7CiAgICAgICAgbWFyZ2luLXRvcDogNnB4OwogICAgICAgIGZvbnQtc2l6ZTogMjRweDsKICAgICAgICBjb2xvcjogIzNCOTBGRjsKCiAgICAgICAgc3BhbiB7CiAgICAgICAgICBmb250LXNpemU6IDM4cHg7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0wIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA0OXB4OwogICAgICBiYWNrZ3JvdW5kOiB1cmwoJ35AL2Fzc2V0cy9pbWcvbGl2ZS1naWZ0LWJnMC5wbmcnKSAwIDAgbm8tcmVwZWF0OwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsKCiAgICAgIC5naWZ0LWNvdW50IHsKICAgICAgICBjb2xvcjogIzNCOTBGRjsKICAgICAgfQoKICAgICAgLmdpZnQtYXZhdGFyIHsKICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0xIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA0OXB4OwogICAgICBiYWNrZ3JvdW5kOiB1cmwoJ35AL2Fzc2V0cy9pbWcvbGl2ZS1naWZ0LWJnMS5wbmcnKSAwIDAgbm8tcmVwZWF0OwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsKCiAgICAgIC5naWZ0LWNvdW50IHsKICAgICAgICBjb2xvcjogI0VENUIxRTsKICAgICAgfQoKICAgICAgLmdpZnQtYXZhdGFyIHsKICAgICAgICBkaXNwbGF5OiBub25lOwogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0yIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA1M3B4OwogICAgICBwYWRkaW5nLWxlZnQ6IDMwcHg7CiAgICAgIGJhY2tncm91bmQ6IHVybCgnfkAvYXNzZXRzL2ltZy9saXZlLWdpZnQtYmcyLnBuZycpIDAgMCBuby1yZXBlYXQ7CiAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICBiYWNrZ3JvdW5kLWNsaXA6IGNvbnRlbnQtYm94OwoKICAgICAgLmdpZnQtY291bnQgewogICAgICAgIGNvbG9yOiAjRkY2RDE1OwogICAgICB9CgogICAgICAuZ2lmdC1jb250ZW50IHsKICAgICAgICBwYWRkaW5nLWxlZnQ6IDM2cHg7CiAgICAgICAgd2lkdGg6IDkwcHg7CiAgICAgIH0KCiAgICAgIC5naWZ0LXRpdGxlIHsKICAgICAgICBtYXJnaW4tdG9wOiAxMnB4OwogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgfQoKICAgICAgLmdpZnQtaWNvbiB7CiAgICAgICAgbWFyZ2luLXRvcDogLTE1cHg7CiAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgICAgICAgd2lkdGg6IDYwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICB9CiAgICB9CgogICAgLmdpZnQtaXRlbS0zIHsKICAgICAgbWFyZ2luLXRvcDogMzJweDsKICAgICAgaGVpZ2h0OiA1M3B4OwogICAgICBwYWRkaW5nLWxlZnQ6IDMwcHg7CiAgICAgIGJhY2tncm91bmQ6IHVybCgnfkAvYXNzZXRzL2ltZy9saXZlLWdpZnQtYmczLnBuZycpIDAgMCBuby1yZXBlYXQ7CiAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICBiYWNrZ3JvdW5kLWNsaXA6IGNvbnRlbnQtYm94OwoKICAgICAgLmdpZnQtY291bnQgewogICAgICAgIGNvbG9yOiAjNDk2N0YwOwogICAgICB9CgogICAgICAuZ2lmdC1jb250ZW50IHsKICAgICAgICBwYWRkaW5nLWxlZnQ6IDM2cHg7CiAgICAgICAgd2lkdGg6IDkwcHg7CiAgICAgIH0KCiAgICAgIC5naWZ0LXRpdGxlIHsKICAgICAgICBtYXJnaW4tdG9wOiAxMnB4OwogICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgfQoKICAgICAgLmdpZnQtaWNvbiB7CiAgICAgICAgbWFyZ2luLXRvcDogLTE1cHg7CiAgICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7CiAgICAgICAgd2lkdGg6IDYwcHg7CiAgICAgICAgaGVpZ2h0OiA2MHB4OwogICAgICB9CiAgICB9CiAgfQoKICAuY2hhdCB7CiAgICBoZWlnaHQ6IDEwMCU7CiAgICBwYWRkaW5nOiAwIDE1cHg7CiAgICAvKmhlaWdodDogY2FsYygxMDB2aCAtIDQ5MHB4KTsqLwogICAgZm9udC1zaXplOiAxMnB4OwogICAgbGluZS1oZWlnaHQ6IDE4cHg7CiAgICBjb2xvcjogJGNvbG9yLXRpdGxlMjsKCiAgICBvdmVyZmxvdy14OiBoaWRkZW47CiAgICBvdmVyZmxvdy15OiBzY3JvbGw7CgogICAgLm1haW4gewogICAgICBjb2xvcjogJGNvbG9yLW1haW47CiAgICB9CgogICAgLmJhbiB7CiAgICAgIGNvbG9yOiAkY29sb3ItYmFuOwogICAgfQoKICAgIC5ob25nYmFvIHsKICAgICAgY29sb3I6ICRjb2xvci1yZWQtZW52ZWxvcGU7CiAgICB9CgogICAgLmdpZnQgewogICAgICBjb2xvcjogJGNvbG9yLWdpZnQ7CiAgICB9CgoKICAgIC5jaGF0LWl0ZW0gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBwYWRkaW5nOiA3cHggMDsKICAgIH0KCiAgICAuaXRlbS1uYW1lIHsKICAgICAgZmxleDogMTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBAZXh0ZW5kIC5tYWluOwogICAgfQoKICAgIC5pdGVtLWNvbnRlbnQgewogICAgICBtYXJnaW4tbGVmdDogMTBweDsKICAgICAgY3Vyc29yOiBkZWZhdWx0OwogICAgICBjb2xvcjogJGNvbG9yLXRpdGxlMjsKICAgIH0KCiAgICAuZ2lmdC1pY29uIHsKICAgICAgd2lkdGg6IDMycHg7CiAgICAgIGhlaWdodDogMzJweDsKICAgIH0KCiAgICAucm9sZS1pY29uIHsKICAgICAgbWFyZ2luLXJpZ2h0OiA0cHg7CiAgICAgIHdpZHRoOiAyNnB4OwogICAgICBoZWlnaHQ6IDE0cHg7CiAgICB9CiAgfQoKICAubmV3LW1lc3NhZ2UtYnRuIHsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIGJvdHRvbTogMDsKICAgIHJpZ2h0OiAwOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDM0cHg7CiAgICBsaW5lLWhlaWdodDogMzRweDsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIGJhY2tncm91bmQ6IHJnYmEoMjQ2LCAyNDksIDI1NSwgMSk7CiAgICBjdXJzb3I6IHBvaW50ZXI7CiAgfQp9Cgo="},{"version":3,"sources":["LiveroomChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8dA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LiveroomChat.vue","sourceRoot":"src/components/liveroom","sourcesContent":["<template>\n  <div class=\"live-chat\">\n    <!--横幅礼物-->\n    <transition-group name=\"gift\" appear tap=\"div\" class=\"gift-item\">\n      <div v-for=\"(item) in showingList\" :key=\"item.vueKey\">\n        <div v-if=\"item.active\" class=\"gift-item-wrap\" :class=\"classObject(item)\">\n          <img class=\"gift-avatar\" :src=\"item.user.avatar\" alt=\"\">\n          <div class=\"gift-content\">\n            <div class=\"gift-title\">{{ item.user.name }}</div>\n            <div class=\"gift-name\">送出 {{ item.gift.name }}</div>\n          </div>\n          <img class=\"gift-icon\" :src=\"item.gift.picture\" alt=\"\">\n          <div class=\"gift-count font-gift\">x <span>{{ item.gift.number }}</span></div>\n        </div>\n      </div>\n    </transition-group>\n\n    <!--聊天室-->\n    <section class=\"chat-wrap\">\n      <!--聊天内容-->\n      <section ref=\"chat\" class=\"chat\" id=\"chat\" @scroll=\"chatScroll\" @click.stop=\"handleBan\">\n        <div class=\"chat-item\" v-for=\"(item,index) in msgList\" :key=\"item.sign\">\n          <!--消息三种类型 1 发言 name: content 2 礼物 name num pic 3 系统通知 颜色不同-->\n          <!--文本消息-->\n          <template v-if=\"item._lctype === -1\">\n            <img class=\"role-icon\" v-if=\"item._lcattrs.user.role != 0\"\n                 :src=\"require('@/assets/img/live-chat-role'+item._lcattrs.user.role+'.png')\" alt=\"\">\n            <div>\n              <span class=\"item-name\" :data-item=\"index\">{{ item._lcattrs.user.name }}:            </span>\n              <span\n                class=\"item-content\">{{ item._lctext }}</span></div>\n          </template>\n          <!--系统消息&禁言-->\n          <template v-else-if=\"item._lctype === 1 || item._lctype === 5\">\n            <span class=\"main\"\n                  :class=\"{'ban':item._lctype === 5, 'hongbao': item._lctype === 1 && (item._lcattrs && item._lcattrs.sm.type === 0)}\">{{ item._lctext }}</span>\n          </template>\n          <!--礼物  老张涨涨送给主播甜甜圈 66-->\n          <template v-else-if=\"item._lctype === 2\">\n            <span class=\"gift\">{{ item._lcattrs.user.name }}送给主播{{ item._lcattrs.gift.name }}</span>\n            <img class=\"gift-icon\" :src=\"item._lcattrs.gift.picture\" alt=\"\">\n            <span class=\"gift\">{{ item._lcattrs.gift.number }}</span>\n          </template>\n          <!--<span v-if=\"item._lctype === 1\" class=\"item-name\" :data-item=\"item.content\">{{ item._lctext }}</span>-->\n        </div>\n      </section>\n      <!--新消息-->\n      <div class=\"new-message-btn\" v-show=\"newMessage > 0\" @click.stop=\"handleScrollToEnd\"> {{newMessage}}个新消息</div>\n      <!--禁言弹窗-->\n      <LiveroomBan ref=\"ban\" :userInfo=\"userInfo\"></LiveroomBan>\n      <!--红包-->\n<!--      <LiveroomHongbao :userLogin=\"userLogin\" v-for=\"(item,index) in hongbaoList\" :key=\"index\"-->\n<!--                       :hongbaoItem=\"item\" @login=\"$emit('login')\"  @receiveHongBaoSuccess=\"$emit('hongBaoSuccess')\"></LiveroomHongbao>-->\n      <!--礼物gif-->\n      <LiveroomGif :giftItem=\"giftItem\" :giftListToObject=\"giftListToObject\"></LiveroomGif>\n    </section>\n  </div>\n</template>\n\n<script>\n  import LiveroomBan from '@/components/liveroom/LiveroomBan'\n  // import LiveroomHongbao from '@/components/liveroom/LiveroomHongbao'\n  import LiveroomGif from '@/components/liveroom/LiveroomGif'\n\n  import { debounce } from \"@/utils/debounceAndthrottle\";\n\n  /*\n  * 层级\n  * 禁言菜单30>礼物特效25>红包20>礼物横幅15>榜单5>消息\n  *\n  * 礼物横幅 设计思路\n  * showingList 展示中的列表 最大长度3 加入时添加setTimeout，如果展示时间内用户名称和礼物名称相同，则改变礼物数量并重新计算展示时间，时间到了查找showingList里（用户名称和礼物名称）的对应项并删除\n  * taskList 任务列表 添加礼物信息push到最后，更新showingList时shift取出\n  * updateShowingList  （条件是 展示区<3条、缓存区>0）区分入参 兼容同一人统一礼物已展示情况\n  *\n  * 礼物横幅样式规则\n  * 0~0.99元\n  * 1~99元\n  * 100元~499元\n  * 500元以上\n  *\n  * 优化点\n  * 消失前 同一用户同一礼物 更新数量及重新计算展示时间 最多展示3个 遍历对比取值判断可以接受\n  */\n  export default {\n    name: 'LiveroomChat',\n    components: {\n      LiveroomBan,\n      // LiveroomHongbao,\n      LiveroomGif\n    },\n    props: {\n      giftItem: Object,\n      userLogin: {\n        type: Object,\n        default: () => {\n          return {}\n        }\n      },\n      userInfo: {\n        type: Object,\n        default: () => {\n          return {}\n        }\n      },\n      msgList: {\n        type: Array,\n        default: () => {\n          return []\n        }\n      },\n      hongbaoList: {\n        type: Array,\n        default: () => {\n          return []\n        }\n      },\n      giftListToObject: {\n        type: Object,\n        default: () => {\n          return {}\n        }\n      }\n    },\n    // computed: {\n    //   classObject: function (item) {\n    //     console.log(item);\n    //     return {\n    //       active: true,\n    //       'text-danger': true\n    //     }\n    //   }\n    // },\n    watch: {\n      // 弹幕中获取新的礼物\n      giftItem: {\n        handler: function (newValue) {\n          // console.log(oldValue, 'oldValue');\n          // console.log(newValue, 'newValue');\n          if (!newValue) return;\n          // 添加标识\n          newValue.showId = newValue.gift.anchorName + '_' + newValue.gift.id\n          newValue.active = false\n          newValue.vueKey = new Date().getTime()\n          let item = JSON.parse(JSON.stringify(newValue));\n          this.taskList.push(item)\n          this.$nextTick(() => {\n            this.updateShowingList(item)\n          })\n        },\n        immediate: false\n      },\n      // 弹幕信息\n      msgList: {\n        handler: function () {\n          // console.log(oldValue, 'oldValue');\n          // console.log(newValue, 'newValue');\n          if (this.$refs.chat) {\n            let scrollTarget = this.$refs.chat;\n            // 到底或者 滚动高度大于视图高度\n            let isScrollToEnd = (scrollTarget.scrollHeight - scrollTarget.scrollTop === scrollTarget.clientHeight) || (scrollTarget.scrollHeight <= scrollTarget.clientHeight + 15);// hack scrollHeight默认大于clientHeight问题\n\n            console.log(scrollTarget.scrollTop, 'scrollTarget.scrollTop');\n            console.log(scrollTarget.scrollHeight, 'scrollTarget.scrollHeight');\n            console.log(scrollTarget.clientHeight, 'scrollTarget.clientHeight');\n            console.log(isScrollToEnd, 'isScrollToEnd');\n\n            this.$nextTick(() => {\n              // 添加消息 有scrollTop 或者 内容>视口\n              let isAddMessage = scrollTarget.scrollTop > 0 || scrollTarget.scrollHeight >= scrollTarget.clientHeight + 15\n              console.log(isAddMessage);\n              if (isScrollToEnd) {\n                this.newMessage = 0;\n                scrollTarget.scrollTop = scrollTarget.scrollHeight\n              } else if (isAddMessage) {\n                // 未显示的消息增加\n                this.newMessage++\n              }\n            })\n          }\n        },\n        immediate: false\n      }\n    },\n    data() {\n      return {\n        // hongbaoList: [],\n        banDialog: false,\n        // scrollTarget: null,\n        newMessage: 0, // 未显示的消息\n\n        showingList: [\n          // {\n          //   showId: '冯曦妤_12915206930636800',\n          //   active: true,\n          //   vueKey: 1,\n          //   \"gift\": {\n          //     \"anchorId\": \"6919164\",\n          //     \"anchorName\": \"冯曦妤\",\n          //     \"id\": 12915206930636802,\n          //     \"name\": \"浪味仙\",\n          //     \"number\": 1,\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\n          //     \"showGift\": true,\n          //     \"totalFee\": 10\n          //   },\n          //   \"pType\": 0,\n          //   \"pid\": \"6919164\",\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\n          //   \"user\": {\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\n          //     \"id\": \"3486074\",\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\n          //   }\n          // }, {\n          //   showId: '冯曦妤_12915206930636801',\n          //   active: true,\n          //   vueKey: 2,\n          //   \"gift\": {\n          //     \"anchorId\": \"6919164\",\n          //     \"anchorName\": \"冯曦妤\",\n          //     \"id\": 12915206930636802,\n          //     \"name\": \"浪味仙\",\n          //     \"number\": 1,\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\n          //     \"showGift\": true,\n          //     \"totalFee\": 10000\n          //   },\n          //   \"pType\": 0,\n          //   \"pid\": \"6919164\",\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\n          //   \"user\": {\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\n          //     \"id\": \"3486074\",\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\n          //   }\n          // }, {\n          //   showId: '冯曦妤_12915206930636802',\n          //   active: true,\n          //   vueKey: 3,\n          //   \"gift\": {\n          //     \"anchorId\": \"6919164\",\n          //     \"anchorName\": \"冯曦妤\",\n          //     \"id\": 12915206930636802,\n          //     \"name\": \"浪味仙\",\n          //     \"number\": 1,\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\n          //     \"showGift\": true,\n          //     \"totalFee\": 10000000\n          //   },\n          //   \"pType\": 0,\n          //   \"pid\": \"6919164\",\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\n          //   \"user\": {\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\n          //     \"id\": \"3486074\",\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\n          //   }\n          // }, {\n          //   showId: '冯曦妤_12915206930636803',\n          //   active: true,\n          //   vueKey: 4,\n          //   \"gift\": {\n          //     \"anchorId\": \"6919164\",\n          //     \"anchorName\": \"冯曦妤\",\n          //     \"id\": 12915206930636802,\n          //     \"name\": \"浪味仙\",\n          //     \"number\": 1,\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\n          //     \"showGift\": true,\n          //     \"totalFee\": 1000\n          //   },\n          //   \"pType\": 0,\n          //   \"pid\": \"6919164\",\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\n          //   \"user\": {\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\n          //     \"id\": \"3486074\",\n          //     \"name\": \"晨曦吻月晨曦吻月曦吻月晨曦吻月曦吻月晨曦吻月晨曦吻月\"\n          //   }\n          // },\n          // {\n          //   showId: '冯曦妤_12915206930636802',\n          //   active:true,\n          //   vueKey:2,\n          //   \"gift\": {\n          //     \"anchorId\": \"6919164\",\n          //     \"anchorName\": \"冯曦妤\",\n          //     \"id\": 12915206930636802,\n          //     \"name\": \"浪味仙\",\n          //     \"number\": 1,\n          //     \"picture\": \"https://pic.imifan.live/gifts/langXianXian/2019101819283913031452620677141.png\",\n          //     \"showGift\": true,\n          //     \"totalFee\": 10\n          //   },\n          //   \"pType\": 0,\n          //   \"pid\": \"6919164\",\n          //   \"sign\": \"286403A393C275046C3053CA7EBE4ADD\",\n          //   \"user\": {\n          //     \"avatar\": \"https://pic.imifan.live/avatar/2019103119455113183057850163209.png\",\n          //     \"id\": \"3486074\",\n          //     \"name\": \"晨曦吻月\"\n          //   }\n          // }\n        ], // 展示中的礼物横条\n        taskList: [] // 待展示的礼物横条\n      }\n    },\n    created() {\n      // test 红包\n      // this.hongbaoList.push({\n      //\n      // })\n      // this.hongbaoList.push({\n      //\n      // })\n      // this.updateShowingList()\n      // console.log(this.giftItem, 'giftItem');\n    },\n    mounted() {\n      // this.scrollTarget = document.getElementById(\"chat\")\n    },\n    methods: {\n      /**\n       * 0~0.99元\n       * 1~99元\n       * 100元~499元\n       * 500元以上\n       * */\n      classObject(item) {\n        console.log(item.gift.totalFee);\n        return {\n          'gift-item-0': item.gift.totalFee >= 0 && item.gift.totalFee <= 99,\n          'gift-item-1': item.gift.totalFee >= 99 && item.gift.totalFee <= 9900,\n          'gift-item-2': item.gift.totalFee >= 10000 && item.gift.totalFee <= 49900,\n          'gift-item-3': item.gift.totalFee >= 50000,\n        }\n      },\n      // 点击用户姓名 判断条件权限 是否线上禁用弹窗\n      handleBan(e) {\n        console.log(e);\n        // if (e.target.className.toLowerCase() == \"item-name\" && e.target.dataset.item) {\n          this.$refs.ban.show(this.msgList[e.target.dataset.item])\n          console.log(this.msgList[e.target.dataset.item]);\n          console.log(e.target.dataset.item);\n        // }\n      },\n      // 节流处理 滚动到底 push信息也会触发\n      chatScroll: debounce(function (e) {\n        if (e && e.target.scrollHeight - e.target.scrollTop == e.target.clientHeight) {\n          this.newMessage = 0;\n          e.target.scrollTop = e.target.scrollHeight\n        }\n        console.log(e);\n      }, 500, false),\n      // chatScroll(e) {\n      //   if (e.target.scrollHeight - e.target.scrollTop == e.target.clientHeight) {\n      //     this.newMessage = 0;\n      //     e.target.scrollTop = e.target.scrollHeight\n      //   }\n      //   console.log(e);\n      // },\n      // 手动点击回到底部\n      handleScrollToEnd() {\n        let scrollTarget = this.$refs.chat;\n        scrollTarget.scrollTop = scrollTarget.scrollHeight;\n        this.newMessage = 0;\n      },\n      /**\n       * 横幅显示时间\n       * 大于100块，2分钟\n       * 大于50块数目小于10块，1.5分钟\n       * 大于10块小于50块并且礼物数小于10，显示1分钟\n       * 其他情况是，3秒+礼物的总价格*3毫秒\n       * 异常 3s\n       */\n      showingTime(totalFee) {\n        if (isNaN(totalFee)) totalFee = 0;\n        if (totalFee > 100 * 100) {\n          return 1000 * 60 * 2;\n        } else if (totalFee > 50 * 100) {\n          return 1000 * 60 * 1.5;\n        } else if (totalFee > 10 * 100) {\n          return 1000 * 60 * 1;\n        } else {\n          return 1000 * 3 + totalFee * 3;\n        }\n      },\n      /**\n       * 移除过期横幅及更新定时器\n       * @param type update/clear\n       * @param item 展示项\n       * @param callBack\n       * @returns {number}\n       */\n      updateSetTimeout(type, item, callBack) {\n        let timer = null;\n        timer = setTimeout(() => {\n          console.log(item.showId, 'showId');\n          console.log(this.showingTime(item.gift.totalFee), '显示时间');\n\n          // 离开动画\n          item.active = type == 'update' ? true : false;\n          // 通过showId更新位置\n          let showId = item.showId\n          let index = this.showingList.findIndex(item => (item.showId == showId))\n          if (index !== undefined) this.showingList.splice(index, 1)\n\n          if (callBack) callBack()\n        }, this.showingTime(item.gift.totalFee))\n\n        // 清除绑定的定时器\n        this.$once('hook:beforeDestroy', () => {\n          console.log(\"hook:beforeDestroy\");\n          clearTimeout(timer);\n        })\n        return timer;\n      },\n      // 更新横幅\n      updateShowingList(newMessage) {\n        console.log('updateShowingList----start');\n\n        let isUpdate = false; // 更新现有横幅/需要继续插入显示列表\n        // 优先判断是否是 同一用户用一种礼物\n        if (newMessage && this.showingList.length > 0 && this.showingList.length < 3) {\n          console.log(newMessage, 'newMessage');\n          // 显示两个同名字同礼物的横幅  更新显示的时间是第一个时间\n          this.showingList.forEach((item) => {\n            if (isUpdate) return;\n            if (item.showId == newMessage.showId) {\n              console.log('重复遍历');\n              // 有在显示的横幅 移除队列最新推入项\n              this.taskList.pop()\n              // 更新显示的横幅\n              item.gift.number = item.gift.number + newMessage.gift.number\n              // 更新定时器\n              clearTimeout(item.timer);\n              item.timer = this.updateSetTimeout('update', item);\n              isUpdate = true;\n            }\n          })\n        }\n\n        console.log(isUpdate, 'isUpdate');\n        if (!isUpdate && this.showingList.length < 3 && this.taskList.length > 0) {\n          const item = this.taskList.shift()\n          // 进场动画\n          item.active = true;\n          // 定时移除显示\n          item.timer = this.updateSetTimeout('clear', item, this.updateShowingList)\n\n          // item.timer = setTimeout(() => {\n          //   let showId = item.showId;\n          //\n          //     // 离开动画\n          //   item.active = true;\n          //   console.log(item.gift.anchorName,'item.gift.anchorName');\n          //\n          //   let index = this.showingList.findIndex((item,index) => {\n          //     console.log(this.showingList[index].gift.anchorName);\n          //     return (item.showId == showId)\n          //   })\n          //   if(index !== undefined) this.showingList.splice(index,1)\n          //   // 更新队列\n          //   this.updateShowingList()\n          //\n          // }, this.showingTime(item.gift.totalFee))\n\n          this.showingList.push(item);\n        }\n\n        console.log('updateShowingList----end');\n      }\n    }\n  }\n</script>\n\n<style scoped lang=\"scss\">\n  @import \"@/assets/css/_index.scss\";\n\n  .live-chat {\n    position: relative;\n\n    .chat-wrap {\n      position: relative;\n      height: calc(100vh - 260px);\n      border-top: 1px solid $color-border;\n      border-bottom: 1px solid $color-border;\n    }\n\n    .gift-item {\n      position: absolute;\n      top: 0;\n      left: 0;\n      z-index: 15;\n      width: 100%;\n      line-height: 1;\n\n      .gift-item-wrap {\n        position: relative;\n        display: flex;\n        height: 100%;\n\n        .gift-avatar {\n          position: absolute;\n          left: 0;\n          top: 0;\n          margin-top: -5px;\n          width: 60px;\n          height: 60px;\n          box-sizing: border-box;\n          border: 3px solid #FFEDBF;\n          border-radius: 50%;\n        }\n\n        .gift-content {\n          width: 144px;\n          padding-left: 17px;\n        }\n\n        .gift-title {\n          margin-top: 10px;\n          margin-bottom: 4px;\n          font-size: 13px;\n          font-weight: 500;\n          color: rgba(255, 244, 157, 1);\n          text-shadow: 1px 1px 1px rgba(45, 45, 45, 0.45);\n          @include ellipsis(1);\n        }\n\n        .gift-name {\n          font-size: 12px;\n          color: #fff;\n        }\n\n        .gift-icon {\n          margin-top: -12px;\n          margin-right: 12px;\n          width: 48px;\n          height: 48px;\n        }\n\n        .gift-count {\n          margin-top: 6px;\n          font-size: 24px;\n          color: #3B90FF;\n\n          span {\n            font-size: 38px;\n          }\n        }\n      }\n\n      .gift-item-0 {\n        margin-top: 32px;\n        height: 49px;\n        background: url('~@/assets/img/live-gift-bg0.png') 0 0 no-repeat;\n        background-size: 100% 100%;\n\n        .gift-count {\n          color: #3B90FF;\n        }\n\n        .gift-avatar {\n          display: none;\n        }\n      }\n\n      .gift-item-1 {\n        margin-top: 32px;\n        height: 49px;\n        background: url('~@/assets/img/live-gift-bg1.png') 0 0 no-repeat;\n        background-size: 100% 100%;\n\n        .gift-count {\n          color: #ED5B1E;\n        }\n\n        .gift-avatar {\n          display: none;\n        }\n      }\n\n      .gift-item-2 {\n        margin-top: 32px;\n        height: 53px;\n        padding-left: 30px;\n        background: url('~@/assets/img/live-gift-bg2.png') 0 0 no-repeat;\n        background-size: 100% 100%;\n        background-clip: content-box;\n\n        .gift-count {\n          color: #FF6D15;\n        }\n\n        .gift-content {\n          padding-left: 36px;\n          width: 90px;\n        }\n\n        .gift-title {\n          margin-top: 12px;\n          font-size: 14px;\n        }\n\n        .gift-icon {\n          margin-top: -15px;\n          margin-right: 8px;\n          width: 60px;\n          height: 60px;\n        }\n      }\n\n      .gift-item-3 {\n        margin-top: 32px;\n        height: 53px;\n        padding-left: 30px;\n        background: url('~@/assets/img/live-gift-bg3.png') 0 0 no-repeat;\n        background-size: 100% 100%;\n        background-clip: content-box;\n\n        .gift-count {\n          color: #4967F0;\n        }\n\n        .gift-content {\n          padding-left: 36px;\n          width: 90px;\n        }\n\n        .gift-title {\n          margin-top: 12px;\n          font-size: 14px;\n        }\n\n        .gift-icon {\n          margin-top: -15px;\n          margin-right: 8px;\n          width: 60px;\n          height: 60px;\n        }\n      }\n    }\n\n    .chat {\n      height: 100%;\n      padding: 0 15px;\n      /*height: calc(100vh - 490px);*/\n      font-size: 12px;\n      line-height: 18px;\n      color: $color-title2;\n\n      overflow-x: hidden;\n      overflow-y: scroll;\n\n      .main {\n        color: $color-main;\n      }\n\n      .ban {\n        color: $color-ban;\n      }\n\n      .hongbao {\n        color: $color-red-envelope;\n      }\n\n      .gift {\n        color: $color-gift;\n      }\n\n\n      .chat-item {\n        display: flex;\n        align-items: center;\n        padding: 7px 0;\n      }\n\n      .item-name {\n        flex: 1;\n        cursor: pointer;\n        @extend .main;\n      }\n\n      .item-content {\n        margin-left: 10px;\n        cursor: default;\n        color: $color-title2;\n      }\n\n      .gift-icon {\n        width: 32px;\n        height: 32px;\n      }\n\n      .role-icon {\n        margin-right: 4px;\n        width: 26px;\n        height: 14px;\n      }\n    }\n\n    .new-message-btn {\n      position: absolute;\n      bottom: 0;\n      right: 0;\n      width: 100%;\n      height: 34px;\n      line-height: 34px;\n      text-align: center;\n      background: rgba(246, 249, 255, 1);\n      cursor: pointer;\n    }\n  }\n\n</style>\n"]}]}